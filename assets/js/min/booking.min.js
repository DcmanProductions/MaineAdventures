/* LFInteractive LLC. All Rights Reserved */
(()=>{function e(){let e=$("#cabin-image");$("#cabin-names")[0].innerHTML="";let t=0;i.forEach(n=>{let a=0!=n.seasonal;if(l.isNightly&&!a||!l.isNightly&&a){let a=document.createElement("p");a.id=n.name.replaceAll(" ","-").toLowerCase(),a.innerText=`${n.name} (${n.people} people) - ${s.format(n.price)}/night`,$("#cabin-names")[0].appendChild(a),$(a).attr("index",t),$(a).on("click",()=>{let t=`/assets/images/cabins/${n.image}.jpg`;Array.from($("#cabin-names p[selected]")).forEach(e=>{$(e).attr("selected",null)}),$(a).attr("selected",""),e.css("background-image",`url('${t}')`),function(e){let t;t=i[e],l.cabin.name=t.name,l.cabin.price=t.price,l.cabin.people=t.people}($(a).attr("index"))}),0==t&&a.click()}t++}),$("#cabin-names p")[0].click()}function t(){let e=0,t=l.cabin.price*l.nights,n=15*l.people.adults*l.nights,a=10*l.people.children*l.nights,r=10*l.people.pets*l.nights;e+=n,l.people.children>0&&(e+=a),l.people.pets>0&&(e+=r),e+=t,l.price=e,e=s.format(e),$("#itemized-cabin-name")[0].innerText=l.cabin.name,$("#itemized-nights")[0].innerText=`${l.nights} Nights`,$("#itemized-cabin-price")[0].innerText=s.format(t),$("#itemized-cabin-price-per")[0].innerText=s.format(l.cabin.price),$("#itemized-adults-count")[0].innerText=l.people.adults,$("#itemized-adults-price")[0].innerText=s.format(n),$("#itemized-adults-price-per")[0].innerText=s.format(15),$("#itemized-children-count")[0].innerText=l.people.children,$("#itemized-children-price")[0].innerText=s.format(a),$("#itemized-children-price-per")[0].innerText=s.format(10),$("#itemized-pets-count")[0].innerText=l.people.pets,$("#itemized-pets-price")[0].innerText=s.format(r),$("#itemized-pets-price-per")[0].innerText=s.format(10),null!=l.card?$("#card-suffix")[0].innerText=l.card:$("#itemized-paid").css("display","none"),$("#total-balance")[0].innerHTML=e}function n(n){$("#section-navigation").css("opacity",""),$("#previous").attr("disabled",null),$("#next").attr("disabled",null),$(`#${n}`).css("display",""),$(`#${n}`)[0].scrollIntoView(),c.current=n,c.previous=$(`#${c.current}`).attr("previous"),c.next=$(`#${c.current}`).attr("next"),$("#previous").attr("disabled",""),$("#next").attr("disabled",""),"cabin"==c.current&&e(),"success"==c.current&&$("#section-navigation").css("opacity",0),"itemized"==c.current&&($("#sections").css("display","none"),$("#section-navigation").css("display","none"),t(),$(`#${n}`)[0].scrollIntoView()),setTimeout(()=>{c.element.querySelectorAll("section").forEach(e=>{e.id!=n&&$(e).css("display","none")}),null==c.next?$("#next").attr("disabled",""):$("#next").attr("disabled",null),null==c.previous?$("#previous").attr("disabled",""):$("#previous").attr("disabled",null),"contact-information"==c.current&&(r()?$("#next").attr("disabled",null):$("#next").attr("disabled","")),"payment-method"==c.current&&$("#next").attr("disabled","")},500)}function a(e){let t=("0"+e.getDate()).slice(-2),n=("0"+(e.getMonth()+1)).slice(-2);return`${e.getFullYear()}-${n}-${t}`}function r(){let e=!1;return 1!=$("#email[interacted]").length||/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test($("#email[interacted]").val())?$("#email[interacted]").removeClass("error"):$("#email[interacted]").addClass("error"),1==$("#fname[interacted]").length&&0==$("#fname[interacted]").val().length?$("#fname[interacted]").addClass("error"):$("#fname[interacted]").removeClass("error"),1==$("#lname[interacted]").length&&0==$("#lname[interacted]").val().length?$("#lname[interacted]").addClass("error"):$("#lname[interacted]").removeClass("error"),1==$("#telephone-number[interacted]").length&&10!=$("#telephone-number[interacted]").val().replaceAll("(","").replaceAll(")","").replaceAll("-","").replaceAll(" ","").length?$("#telephone-number[interacted]").addClass("error"):$("#telephone-number[interacted]").removeClass("error"),Array.from($("#contact-information input")).forEach(t=>{(0==t.value.length||t.classList.contains("error"))&&(e=!0)}),!e}let i=Array.prototype,l={isNightly:"nightly",cabin:{name:"",price:0},people:{adults:0,children:0,pets:0},nights:7,card:null,price:0},s=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),c={element:$("#sections")[0],current:"time-span",next:"cabin",previous:null};$("#inperson-payment-card").on("click",()=>{$("#previous").attr("disabled",""),$("#next").attr("disabled",""),async function(e,r,i){t();let s=null==e,c=new FormData;c.append("first_name",$("#contact-information #fname").val()),c.append("last_name",$("#contact-information #lname").val()),c.append("email",$("#contact-information #email").val()),c.append("phone",$("#contact-information #telephone-number").val()),c.append("adults",l.adults),c.append("children",l.children),c.append("pets",l.people.pets),c.append("cabin",l.cabin.name),c.append("arrival",`${a($("#start-date")[0].valueAsDate)} ${$("#start-time").val()}`),c.append("departure",`${a($("#end-date")[0].valueAsDate)} ${$("#end-time").val()}`),c.append("seasonal",!l.isNightly),c.append("price",l.price);let o=-1,p=await fetch("/assets/php/bookings.inc.php?c=create",{method:"POST",body:c});if(p.ok){try{o=(await p.json()).id}catch{}if(-1!=o){if(!s){c=new FormData,c.append("id",o),c.append("card",e),c.append("card_exp",i),c.append("cvc",r),c.append("price",Math.ceil(100*l.price));let t=await fetch("/assets/php/payments.inc.php",{method:"POST",body:c});if(!t.ok){let e={error:"Unexpected error has occurred when attempting to process your payment!"};try{e=await t.json()}catch{}return void alert(e.error)}{let t=e.split("").length;l.card=`x${e.slice(t-4,t)}`}}n("itemized")}else alert("Unable to process request at this time!")}else{console.error("not ok");let e={error:"Unable to process request at this time!"};try{e=await p.json()}catch{}alert(e.error)}}()}),$("#time-span .card").on("click",e=>{l.isNightly="Nightly"==e.currentTarget.querySelector(".name").innerText,n("cabin"),$("#section-navigation").css("opacity","")}),$("#next").on("click",e=>{null==$(e.currentTarget).attr("disabled")&&n(c.next)}),$("#previous").on("click",e=>{null==$(e.currentTarget).attr("disabled")&&n(c.previous)}),$("input[type=tel]").on("keydown",e=>{let t=e.key;"Enter"!=t&&"Backspace"!=t&&(isNaN(t)||isNaN(parseInt(t)))&&e.preventDefault()}),$("input[type=tel]").on("change",e=>{let t=e.currentTarget,n=$(t).val().replace(/\D/g,"");if(""!=n){let e=n.substring(0,3),a=n.substring(3,6),r=n.substring(6,10);$(t).val(`(${e}) ${a}-${r}`)}}),$("#online-payment-card").on("click",()=>{n("online-payment")}),$("#contact-information input").on("focus",e=>$(e.target).attr("interacted","")),$("#contact-information input").on("keyup",()=>{r()?$("#next").attr("disabled",null):$("#next").attr("disabled","")}),$(".btn.print").on("click",()=>function(){let e=window.open("","PRINT","width=1280,height=720,scale=200");e.document.write(`<html>\n        <head>\n            <link rel="stylesheet" href="/assets/css/min/main.min.css">\n            <link rel="stylesheet" href="/assets/css/min/social-media.min.css">\n            <link rel="stylesheet" href="/assets/css/min/inputs.min.css">\n            <link rel="stylesheet" href="/assets/css/min/links.min.css">\n            <link rel="stylesheet" href="/assets/css/min/nav.min.css">\n            <link rel="stylesheet" href="/assets/css/min/scrollbar.min.css">\n            <link rel="stylesheet" href="/assets/css/min/booking.min.css">\n            <link rel="stylesheet" href="/assets/css/min/footer.min.css">\n            <style>\n                .btn{\n                    display:none;\n                }\n            </style>\n        </head>\n        <body>\n        <div id="itemized">\n            ${$("#itemized").html()}\n        </div>\n        </body>\n        </html>`),e.document.close(),e.onload=()=>{e.focus(),e.print(),e.close()}}()),async function(){let e=await fetch("/assets/php/cabins.inc.php?c=get"),t={error:"Unexpected error has occurred"};try{t=await e.json()}catch(e){console.error(e)}e.ok?i=t:alert(t.error)}(),$(".count").on("click",e=>{let t=e.target,n=t.parentElement;Array.from(n.querySelectorAll(".count")).forEach(e=>{$(e).attr("selected",null)}),$(t).attr("selected",""),$(n).attr("value",t.innerText)}),$("#pets .count").on("click",e=>{l.people.pets=Number.parseInt($(e.target.parentElement).attr("value"))}),$("#adults .count").on("click",e=>{l.people.adults=Number.parseInt($(e.target.parentElement).attr("value"))}),$("#children .count").on("click",e=>{l.people.children=Number.parseInt($(e.target.parentElement).attr("value"))}),$("#pets .count")[0].click(),$("#adults .count")[1].click(),$("#children .count")[3].click(),function(){let e=new Date;e.setDate(e.getDate()+5);let t=a(e);$("#start-date")[0].value=t,$("input[type=date]").attr("min",t),e.setDate(e.getDate()+7),$("#end-date")[0].value=a(e),$("#start-date, #end-date").on("change",()=>{let e=$("input#end-date")[0].valueAsDate,t=$("input#start-date")[0].valueAsDate,n=Math.round((e-t)/864e5);l.nights=n}),$("#start-date").on("change",e=>{let t=e.target.value;$("#end-date")[0].min=t;let n=e.target.valueAsDate;n>$("#end-date")[0].valueAsDate&&(n.setDate(n.getDate()+7),$("#end-date").val(a(n)))}),$("#end-date").on("change",e=>{let t=e.target.value;$("#start-date")[0].max=t})}()}).call();